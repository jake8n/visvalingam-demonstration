<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Visvalingam demonstration</title>
    <style>
      html {
        color: #111;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <h1>Visvalingam demonstration</h1>
      <h2>canvas width <span id="canvas-width"></span> pixels</h2>
      <h2># points <span id="points-length"></span></h2>
      <div><input id="range" type="range" min="2" /></div>
      <canvas width="720" height="360" id="canvas"></canvas>
    </div>

    <script type="module">
      import aapl from './public/aapl.js'
      import { simplify } from './public/simplify.js'
      import { clearCanvas, useChart } from './public/chart.js'

      const canvas = document.querySelector('#canvas')
      const canvasWidthEl = document.querySelector('#canvas-width')
      const pointsLengthEl = document.querySelector('#points-length')
      const rangeInput = document.querySelector('#range')

      rangeInput.min = 2
      rangeInput.max = aapl.length
      rangeInput.value = aapl.length
      rangeInput.oninput = handleRangeInput

      let stocks = aapl

      update()

      function update() {
        draw()
        updateElements()
      }

      function handleRangeInput({ target: { value } }) {
        stocks = simplify(aapl, aapl.length - value)
        update()
      }

      function draw() {
        clearCanvas(canvas)
        useChart(canvas, stocks)
      }

      function updateElements() {
        canvasWidthEl.innerHTML = canvas.width
        pointsLengthEl.innerHTML = stocks.length
      }
    </script>
  </body>
</html>
